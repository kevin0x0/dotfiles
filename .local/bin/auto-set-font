#!/usr/bin/dash

error() {
  echo "$1" >&2
  exit 1
}

CONFIG_DIR="${XDG_CONFIG_HOME:-$HOME/.config}/auto-set-font"

monofont='monospace'
font='Adwaita Sans'
reload=

while [ $# -ne 0 ]; do
  case "$1" in
    -f|--font)
      [ $# -eq 1 ] && error "Option $1 needs a value"
      shift
      font="$1"
      ;;
    -m|--monofont)
      [ $# -eq 1 ] && error "Option $1 needs a value"
      shift
      monofont="$1"
      ;;
    -r|--reload)
      reload=1
      ;;
    *)
  esac
  shift
done

tmpfile=$(mktemp)
for f in "$CONFIG_DIR/"*; do
  [ -e "$f" ] || continue
  (
    . "$f"
    set_font
    if [ -n "$reload" ]; then
      reload
    fi
  )
done
rm -- "$tmpfile"
