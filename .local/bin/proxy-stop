#!/usr/bin/dash

if ! (umask 0077; set -C; : >"$XDG_RUNTIME_DIR/clash.pid.lock"); then
  echo "Another operation is in progress." >&2
  sleep 0.3
fi

trap 'rm "$XDG_RUNTIME_DIR/clash.pid.lock"' EXIT

# If no clash process is running, exit with code 64
if ! pid=$(cat "$XDG_RUNTIME_DIR/clash.pid"); then
  echo "There are no instance of proxy is running." >&2
  exit 64
fi

rm "$XDG_RUNTIME_DIR/clash.pid"

sudo "$@" kill "$pid"
