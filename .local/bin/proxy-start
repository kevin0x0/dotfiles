#!/usr/bin/dash

# If then clash is already started, exit with code 64

if sudo "$@" ps -A -o exe | grep --quiet "^$HOME/.local/bin/clash$"; then
  echo "An instance of proxy is already running." >&2
  exit 64
fi

CLASH_CONFIG_HOME=${XDG_CONFIG_HOME:=$HOME/.config}/clash

sudo --background "$@" nohup ~/.local/bin/clash -d "$CLASH_CONFIG_HOME" >/dev/null 2>&1
