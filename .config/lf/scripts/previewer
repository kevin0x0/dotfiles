#!/usr/bin/bash

shopt -s extglob

mime_type=$(file --mime-type --brief -- "$1" </dev/null)
case "$mime_type" in
  text/plain)
    cat -- "$1"
    ;;
  @(application/@(yaml|toml|json)|text/*))
    highlight -O ansi -- "$1"
    ;;
  *)
    content=$(file --brief "$1")
    length=${#content}
    width=$(($2 - 3))
    if [ "$width" -le 0 ]; then
      exit
    fi
    for ((i = 0; i < length; i += this_width)); do
      this_width=$((i + width < length ? width : length - i))
      printf "%s\n" "${content:$i:$this_width}"
    done
    ;;
esac
