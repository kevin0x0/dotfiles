#!/usr/bin/dash

. "${XDG_CONFIG_HOME:-$HOME/.config}/i3blocks/scripts/colors"

: ${control:=Master}

: ${button:-0}
case "$button" in
  4)
    amixer set "$control" 2%+ >/dev/null 2>&1
    ;;
  5)
    amixer set "$control" 2%- >/dev/null 2>&1
    ;;
  2)
    amixer set "$control" toggle >/dev/null 2>&1
    ;;
esac


data=$(amixer get "$control" \
  | sed -En '/^\s*Mono:/s/^.*\[(.*)\]\s*\[.*\]\s*\[(.*)\]$/\1 \2/p')

percent=${data%% *}
status=${data##* }

icon=
if [ "$status" = "off" ]; then
  icon=ðŸ”‡
else
  case ${percent%\%} in
    [0-3]?|[0-9])
      icon=ðŸ”ˆ
      ;;
    [4-7]?)
      icon=ðŸ”‰
      ;;
    [8-9]?|100)
      icon=ðŸ”Š
      ;;
  esac
fi

if [ "$status" = "on" ]; then
  color=$color_normal
else
  color=$color_bad
fi

printf "%s %s %s\n" "$icon" "$control" "$percent"
printf "%s %s\n" "$icon" "${percent%\%}"
echo "$color"
