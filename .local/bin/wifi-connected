#!/usr/bin/dash

if [ -z "$interface" ]; then
  configfile=${XDG_CONFIG_HOME:-$HOME/.config}/wifi-connect

  if ! [ -f "$configfile" ]; then
    mkdir -p "${XDG_CONFIG_HOME:-$HOME/.config}"
    wifi-connect-generate-config >"$configfile"

    if ! [ -f "$configfile" ]; then
      echo "Unable to create config file" >&2
      exit 1
    fi
  fi

  . "$configfile"
fi

ifindex=$(cat "/sys/class/net/$interface/ifindex")
phyx=$(cat "/sys/class/net/$interface/phy80211/index")

busctl --system get-property \
  net.connman.iwd \
  "/net/connman/iwd/$phyx/$ifindex" \
  net.connman.iwd.Station \
  ConnectedNetwork >/dev/null 2>&1
